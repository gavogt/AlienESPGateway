# --- MQTT â†’ metrics ---
[[inputs.mqtt_consumer]]
  servers     = ["tcp://emqx:1883"]          # EMQX service name in Compose
  topics      = ["esp_gateway/+/telemetry"]  # single-level wildcard (+)
  client_id   = "telegraf-bridge"
  qos         = 0
  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    measurement_name = "telemetry"

    # Tags
    [[inputs.mqtt_consumer.json_v2.tag]]
      path = "module_type"
    [[inputs.mqtt_consumer.json_v2.tag]]
      path = "scoutId"

    # Fields
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"
      type = "float"

[[outputs.file]]
  files = ["stdout"]     # remove later if noisy

[[outputs.mongodb]]
  dsn         = "mongodb://host.docker.internal:27017"
  database    = "esp_gateway"
  granularity = "seconds"   # time-series collection option
  ttl         = "336h"      # optional data retention